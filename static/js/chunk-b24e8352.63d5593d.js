(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b24e8352"],{"469f":function(t,e,a){a("6c1c"),a("1654"),t.exports=a("7d7b")},"5d73":function(t,e,a){t.exports=a("469f")},"768b":function(t,e,a){"use strict";var r=a("a745"),n=a.n(r);function s(t){if(n()(t))return t}var i=a("5d73"),l=a.n(i),u=a("c8bb"),o=a.n(u);function c(t,e){if(o()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t)){var a=[],r=!0,n=!1,s=void 0;try{for(var i,u=l()(t);!(r=(i=u.next()).done);r=!0)if(a.push(i.value),e&&a.length===e)break}catch(c){n=!0,s=c}finally{try{r||null==u["return"]||u["return"]()}finally{if(n)throw s}}return a}}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function d(t,e){return s(t)||c(t,e)||p()}a.d(e,"a",(function(){return d}))},"7d7b":function(t,e,a){var r=a("e4ae"),n=a("7cd6");t.exports=a("584a").getIterator=function(t){var e=n(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return r(e.call(t))}},"9ce1":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:"SPU名称"}},[a("el-input",{attrs:{type:"text",placeholder:"SPU名称"},model:{value:t.spuInfo.spuName,callback:function(e){t.$set(t.spuInfo,"spuName",e)},expression:"spuInfo.spuName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"品牌"}},[a("el-select",{attrs:{placeholder:"请选择品牌"},model:{value:t.spuInfo.tmId,callback:function(e){t.$set(t.spuInfo,"tmId",e)},expression:"spuInfo.tmId"}},t._l(t.trademarkList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.tmName,value:t.id}})})),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"SPU描述"}},[a("el-input",{attrs:{type:"textarea",placeholder:"SPU描述",rows:"4"},model:{value:t.spuInfo.description,callback:function(e){t.$set(t.spuInfo,"description",e)},expression:"spuInfo.description"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"SPU图片"}},[a("el-upload",{attrs:{multiple:"","file-list":t.spuImageList,action:"/dev-api/admin/product/fileUpload","list-type":"picture-card","on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove,"on-success":t.handleSuccess}},[a("i",{staticClass:"el-icon-plus"})]),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1),t._v(" "),a("el-form-item",{attrs:{label:"销售属性"}},[a("el-select",{attrs:{placeholder:t.unUsedSaleAttrList.length>0?"还有"+t.unUsedSaleAttrList.length+"个未使用":"没有啦!!!",value:""},model:{value:t.attrIdAttrName,callback:function(e){t.attrIdAttrName=e},expression:"attrIdAttrName"}},t._l(t.unUsedSaleAttrList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id+":"+t.name}})})),1),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",disabled:!t.attrIdAttrName},on:{click:t.addSpuSaleAttr}},[t._v("添加销售属性")]),t._v(" "),a("el-table",{staticStyle:{"margin-top":"20px"},attrs:{border:"",data:t.spuInfo.spuSaleAttrList}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"80",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"属性名",prop:"saleAttrName",width:"150px"}}),t._v(" "),a("el-table-column",{attrs:{label:"属性值名称列表"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;e.$index;return[t._l(r.spuSaleAttrValueList,(function(e,n){return a("el-tag",{key:e.id,staticStyle:{"margin-right":"5px"},attrs:{closable:"","disable-transitions":!1},on:{close:function(t){return r.spuSaleAttrValueList.splice(n,1)}}},[t._v("\n            "+t._s(e.saleAttrValueName)+"\n          ")])})),t._v(" "),r.edit?a("el-input",{ref:"saveTagInput",staticStyle:{width:"100px"},attrs:{placeholder:"请输入名称",size:"small"},on:{blur:function(e){return t.handleInputConfirm(r)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(r)}},model:{value:r.saleAttrValueName,callback:function(e){t.$set(r,"saleAttrValueName",e)},expression:"row.saleAttrValueName"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(e){return t.showInput(r)}}},[t._v("+ 添加")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"操作",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){e.row;var r=e.$index;return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.spuInfo.spuSaleAttrList.splice(r,1)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:t.back}},[t._v("返回")])],1)],1)},n=[],s=(a("ac6a"),a("28a5"),a("768b")),i=(a("96cf"),a("3b8d")),l=(a("7f7f"),{props:{visible:Boolean},data:function(){return{dialogImageUrl:"",dialogVisible:!1,spuId:"",spuInfo:{spuName:"",description:"",tmId:"",spuSaleAttrList:[],spuImageList:[]},spuImageList:[],trademarkList:[],saleAttrList:[],attrIdAttrName:""}},computed:{unUsedSaleAttrList:function(){var t=this;return this.saleAttrList.filter((function(e){return t.spuInfo.spuSaleAttrList.every((function(t){return t.saleAttrName!==e.name}))}))}},methods:{save:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.spuInfo,a=this.spuImageList,e.spuImageList=a.map((function(t){return{imgName:t.name,imgUrl:t.response?t.response.data:t.url}})),e.spuSaleAttrList=e.spuSaleAttrList.filter((function(t){return delete t.edit,delete t.saleAttrValueName,t.spuSaleAttrValueList.length>0})),t.next=5,this.$API.spu.addUpdate(e);case 5:r=t.sent,200===r.code?(this.$message.success("保存SPU成功"),this.resetData(),this.$emit("update:visible",!1),this.$emit("saveSuccess")):this.$message.error("保存SPU失败");case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),resetData:function(){this.dialogImageUrl="",this.dialogVisible=!1,this.spuId=null,this.spuInfo={category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]},this.spuImageList=[],this.trademarkList=[],this.saleAttrList=[],this.attrIdAttrName=""},handleInputConfirm:function(t){var e=t.saleAttrValueName,a=t.baseSaleAttrId;if(e){var r=t.spuSaleAttrValueList.some((function(t){return t.saleAttrValueName===e}));r?this.$message.warning("不能重复!"):(t.spuSaleAttrValueList.push({saleAttrValueName:e,baseSaleAttrId:a}),t.edit=!1,t.saleAttrValueName="")}else t.edit=!1},showInput:function(t){var e=this;t.hasOwnProperty("edit")?t.edit=!0:this.$set(t,"edit",!0),this.$nextTick((function(){return e.$refs.saveTagInput.focus()}))},addSpuSaleAttr:function(){var t=this.attrIdAttrName.split(":"),e=Object(s["a"])(t,2),a=e[0],r=e[1];this.spuInfo.spuSaleAttrList.push({baseSaleAttrId:a,saleAttrName:r,spuSaleAttrValueList:[]}),this.attrIdAttrName=""},initLoadAddData:function(t){this.spuInfo.category3Id=t,this.getTrademarkList(),this.getSaleAttrList()},initLoadUpdateData:function(t){this.spuId=t,this.getSpuInfo(),this.getSpuImageList(),this.getTrademarkList(),this.getSaleAttrList()},getSpuInfo:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$API.spu.get(this.spuId);case 2:e=t.sent,this.spuInfo=e.data;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getSpuImageList:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$API.sku.getSpuImageList(this.spuId);case 2:e=t.sent,a=e.data,a.forEach((function(t){t.name=t.imgName,t.url=t.imgUrl})),this.spuImageList=a;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getTrademarkList:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$API.trademark.getList();case 2:e=t.sent,this.trademarkList=e.data;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getSaleAttrList:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$API.spu.getSaleList();case 2:e=t.sent,this.saleAttrList=e.data;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleSuccess:function(t,e,a){console.log("handleSuccess",t,e,a),this.spuImageList=a},handleRemove:function(t,e){console.log("handleRemove",t,e),this.spuImageList=e},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},back:function(){this.resetData(),this.$emit("update:visible",!1),this.$emit("cancel")}}}),u=l,o=a("2877"),c=Object(o["a"])(u,r,n,!1,null,null,null);e["default"]=c.exports}}]);