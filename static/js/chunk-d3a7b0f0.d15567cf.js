(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d3a7b0f0"],{3719:function(t,e,a){},bb2b:function(t,e,a){"use strict";var r=a("3719"),n=a.n(r);n.a},f02e:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",[a("CategorySelector",{ref:"cs",on:{categoryChange:t.handleCategoryChange}})],1),t._v(" "),a("el-card",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowList,expression:"isShowList"}]},[a("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary",icon:"el-icon-plus",disabled:!t.category3Id},on:{click:t.showAdd}},[t._v("添加属性")]),t._v(" "),a("el-table",{attrs:{border:"",data:t.attrs}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"80",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"属性名称",width:"150",prop:"attrName"}}),t._v(" "),a("el-table-column",{attrs:{label:"属性值列表"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;e.$index;return t._l(r.attrValueList,(function(e){return a("el-tag",{key:e.id,staticStyle:{margin:"2px"},attrs:{type:"info"}},[t._v(t._s(e.valueName))])}))}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;e.$index;return[a("HintButton",{attrs:{title:"修改",type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(e){return t.showUpdate(r)}}}),t._v(" "),a("el-popconfirm",{attrs:{title:"确定删除 '"+r.attrName+"' 吗"},on:{onConfirm:function(e){return t.deleteAttr(r.id)}}},[a("hint-button",{attrs:{slot:"reference",title:"删除",type:"danger",icon:"el-icon-delete",size:"mini"},slot:"reference"})],1)]}}])})],1)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShowList,expression:"!isShowList"}]},[a("el-form",{attrs:{inline:"",model:t.attr}},[a("el-form-item",{attrs:{label:"属性名"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入属性名"},model:{value:t.attr.attrName,callback:function(e){t.$set(t.attr,"attrName",e)},expression:"attr.attrName"}})],1)],1),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",disabled:!t.attr.attrName},on:{click:t.addAttrValue}},[t._v("添加属性值")]),t._v(" "),a("el-button",{on:{click:function(e){t.isShowList=!0}}},[t._v("取消")]),t._v(" "),a("el-table",{staticStyle:{margin:"20px 0"},attrs:{border:"",data:t.attr.attrValueList}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"80",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"属性值名称"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row,n=e.$index;return[r.edit?a("el-input",{ref:n,attrs:{size:"mini",placeholder:"请输入属性值名称"},on:{blur:function(e){return t.toShow(r)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.toShow(r)}},model:{value:r.valueName,callback:function(e){t.$set(r,"valueName",e)},expression:"row.valueName"}}):a("span",{staticStyle:{display:"inline-block",width:"100%"},on:{click:function(e){return t.toEdit(r,n)}}},[t._v("\n              "+t._s(r.valueName)+"\n            ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row,n=e.$index;return[a("el-popconfirm",{attrs:{title:"确定删除 '"+r.valueName+"' 吗"},on:{onConfirm:function(e){return t.attr.attrValueList.splice(n,1)}}},[a("HintButton",{attrs:{slot:"reference",title:"删除",type:"danger",icon:"el-icon-delete",size:"mini"},slot:"reference"})],1)]}}])})],1),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:!t.attr.attrName||0===t.attr.attrValueList.length},on:{click:t.save}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:function(e){t.isShowList=!0}}},[t._v("取消")])],1)])],1)},n=[],i=(a("96cf"),a("3b8d")),s=a("0644"),o=a.n(s),l={name:"AttrList",data:function(){return{category1Id:"",category2Id:"",category3Id:"",attrs:[],isShowList:!0,attr:{attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}}},mounted:function(){},watch:{isShowList:function(t){this.$refs.cs.disabled=!t}},methods:{deleteAttr:function(t){var e=this;this.$API.attr.remove(t).then((function(t){e.getAttrs()})).catch((function(t){e.$message.error("删除属性失败")}))},save:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.attr,e.attrValueList=e.attrValueList.filter((function(t){if(""!==t.valueName)return delete t.edit,!0})),0!==e.attrValueList.length){t.next=5;break}return this.$message.warning("至少指定一个属性值名称"),t.abrupt("return");case 5:return t.next=7,this.$API.attr.addOrUpdate(e);case 7:a=t.sent,200===a.code?(this.$message.success("保存属性成功"),this.isShowList=!0,this.getAttrs()):this.$message.error("保存属性失败");case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),toEdit:function(t,e){var a=this;t.hasOwnProperty("edit")?t.edit=!0:this.$set(t,"edit",!0),this.$nextTick((function(){a.$refs[e].focus()}))},toShow:function(t){if(t.valueName){var e=this.attr.attrValueList.some((function(e,a){if(e!==t)return e.valueName===t.valueName}));e?(t.valueName="",this.$message.warning("输入的名称已存在")):t.edit=!1}},showAdd:function(){this.attr={attrName:"",attrValueList:[],categoryId:this.category3Id,categoryLevel:3},this.isShowList=!1},showUpdate:function(t){this.attr=o()(t),this.isShowList=!1},addAttrValue:function(){var t=this;this.attr.attrValueList.push({attrId:this.attr.id,valueName:"",edit:!0}),this.$nextTick((function(){t.$refs[t.attr.attrValueList.length-1].focus()}))},handleCategoryChange:function(t){var e=t.categoryId,a=t.level;1===a?(this.category1Id=e,this.category2Id="",this.category3Id="",this.attrs=[]):2===a?(this.category2Id=e,this.category3Id="",this.attrs=[]):(this.category3Id=e,this.getAttrs())},getAttrs:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.category1Id,a=this.category2Id,r=this.category3Id,t.next=3,this.$API.attr.getList(e,a,r);case 3:n=t.sent,this.attrs=n.data;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},c=l,u=(a("bb2b"),a("2877")),d=Object(u["a"])(c,r,n,!1,null,"e78d7258",null);e["default"]=d.exports}}]);